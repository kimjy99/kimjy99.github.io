---
title: "[JS] 로스트아크 하익 1415~1490 재련 계산기"
last_modified_at: 2022-12-29
categories:
  - 개발
tags:
  - Javascript
excerpt: "로스트아크 하이퍼 익스프레스 1415~1490 재련 계산기"
use_math: true
classes: wide
---

<div class="box-top">
  <div id="text-top-0">방어구</div>
  <div class="wrapper">
    <input type="checkbox" id="switch" onchange="changeRefine()">
    <label for="switch" class="switch_label">
      <span class="onf_btn"></span>
    </label>
  </div>
  <div id="text-top-1">무기</div>
  <select id="select" onchange="changeState()">
    <option value='0'>15 → 16</option>
    <option value='1'>16 → 17</option>
    <option value='2'>17 → 18</option>
    <option value='3'>18 → 19</option>
    <option value='4'>19 → 20</option>
  </select>
  <div id="text-top-2">책 개수</div>
  <input type="range" min="0" max="7" step="1" value="0" class="slider" id="slider" oninput="changeState()">
  <div id="text-books">0개</div>
</div>

<div class="box-calc">
  <table>
    <tr>
      <th></th>
      <th>가격</th>
      <th>개수</th>
    </tr>
    <tr>
      <th id="text0">재봉술 심화</th>
      <td><input id="price0" type="text" size="6" value="400" onchange="changeState()"></td>
      <td id="num0"></td>
    </tr>
    <tr>
      <th id="text1">수호석 결정</th>
      <td><input id="price1" type="text" size="6" onchange="changeState()"></td>
      <td id="num1">480</td>
    </tr>
    <tr>
      <th id="text2">위명돌</th>
      <td><input id="price2" type="text" size="6" onchange="changeState()"></td>
      <td id="num2">10</td>
    </tr>
    <tr>
      <th id="text3">명예의 파편</th>
      <td><input id="price3" type="text" size="6" onchange="changeState()"></td>
      <td id="num3">151</td>
    </tr>
    <tr>
      <th id="text4">중급 오레하</th>
      <td><input id="price4" type="text" size="6" onchange="changeState()"></td>
      <td id="num4">7</td>
    </tr>
    <tr>
      <th id="text5">골드</th>
      <td id="num5">0</td>
      <td></td>
    </tr>
    <tr><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td></tr>
    <tr>
      <th id="text6">책 넣을때</th>
      <td id="num6"></td>
    </tr>
    <tr>
      <th id="text7">안 넣을때</th>
      <td id="num7"></td>
    </tr>
    <tr>
      <th id="text8">평균 시도</th>
      <td id="num8"></td>
    </tr>
    <tr>
      <th id="text9">평균 골드</th>
      <td id="num9"></td>
    </tr>
  </table>

  <div class="v1"></div>
  <table id="calc-table">
    <tr><th>시도</th><th>확률</th><th>장기</th><th>누적장기</th><th>누적성공률</th></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
    <tr><td class="c0"></td><td class="c1"></td><td class="c2"></td><td class="c3"></td><td class="c4"></td></tr>
  </table>
</div>

<style type='text/css'>
  .v1 { padding: 10px;}
  .wrapper { width: 30px; height: 18px; text-align: center; margin: 5px; }
  #switch {
    position: absolute;
    appearance: none;
    -webkit-appearance: none;
  }
  .switch_label {
    position: relative;
    cursor: pointer;
    display: inline-block; width: 30px; height: 18px;
    background: #fff; border: 2px solid #daa;
    border-radius: 10px; transition: 0.2s;
  }
  .switch_label:hover { background: #efefef; }
  .onf_btn {
    position: absolute; top: 2.5px; left: 2px; display: inline-block;
    width: 10px; height: 10px; border-radius: 10px;
    background: #daa; transition: 0.2s;
  }
  #switch:checked+.switch_label { background: #c44; border: 2px solid #c44; }
  #switch:checked+.switch_label:hover { background: #e55; }
  #switch:checked+.switch_label .onf_btn { left: 14px; background: #fff; box-shadow: 1px 2px 3px #00000020; }

  .slider { width: 20%; box-shadow: none; margin-left: 10px; margin-right: 10px; }
  .slider:focus { box-shadow: none; }

  select { padding: 0px; margin-left: 10px; margin-right: 120px; }

  tr, th, td { border: 0px; text-align: center;}

  [class*= "box"] { display: flex; margin-top: 10px; }
  .box-calc { float: left; }
  [id*= "price"] { width: 100% }
  
  .div-table { justify-content: flex-start; float: top; }
  input {text-align: center};
  #calc-table { table-layout: fixed; }
  .c0 { width: 80px; }
  .c1, .c2, .c3 { width: 80px; }
  .c4 { width: 100px; }

</style>

<script>
  function changeRefine() {
    if (document.getElementById("switch").checked) {
      document.getElementById("text0").innerText = "야금술 심화";
      document.getElementById("text1").innerText = "파괴석 결정";
    } else {
      document.getElementById("text0").innerText = "재봉술 심화";
      document.getElementById("text1").innerText = "수호석 결정";
    }
    changeState();
  }

  const notextzero = (x) => {
    return (x.length == 0) ? 0 : parseInt(x);
  };

  const floatFix = (value) => {
	  return parseFloat(value).toFixed(2);
  };

  function changeState() {
    let mat = [[480, 801, 480, 801, 480, 801, 624, 1040, 624, 1040],
               [10, 15, 11, 17, 11, 20, 14, 24, 16, 26],
               [151, 217, 204, 295, 277, 400, 429, 621, 582, 843],
               [7, 8, 7, 10, 8, 11, 11, 14, 11, 16],
               [0, 0, 0, 0, 0, 0, 280, 568, 280, 584]];
    
    let max_book = [7, 7, 13, 13, 20];
    
    let n1 = document.getElementById("select").selectedIndex;
    let n2 = document.getElementById("switch").checked ? 1 : 0;
    let value = n1*2 + n2;
    
    for (let i=1; i<6; i++) {
      document.getElementById("num" + String(i)).innerText = mat[i-1][value];
    }
    document.getElementById("slider").max = max_book[n1];

    let price0 = notextzero(document.getElementById("price0").value);
    let price1 = notextzero(document.getElementById("price1").value);
    let price2 = notextzero(document.getElementById("price2").value);
    let price3 = notextzero(document.getElementById("price3").value);
    let price4 = notextzero(document.getElementById("price4").value);
    let num1 = mat[0][value];
    let num2 = mat[1][value];
    let num3 = mat[2][value];
    let num4 = mat[3][value];
    let num5 = mat[4][value];

    let nobook = price1 * num1 + price2 * num2 + price3 * num3 + price4 * num4 + num5;

    let n_book = document.getElementById("slider").value;
    document.getElementById("text-books").innerText = String(n_book) + "개";

    let p_init = (n1 < 2) ? 0.2 : ((n1 < 4) ? 0.1 : 0.06);
    let p_inc = p_init * 0.05;
    let p_book = p_init * 0.5;

    let i = 1;
    let jg_sum = 0.0;
    let sum = 0.0;
    let jgb = false;
    let try_sum = 0.0;
    let gold_sum = 0.0;

    let col0 = document.getElementsByClassName("c0");
    let col1 = document.getElementsByClassName("c1");
    let col2 = document.getElementsByClassName("c2");
    let col3 = document.getElementsByClassName("c3");
    let col4 = document.getElementsByClassName("c4");
    
    for (let c=0; c<27; c++) {
      col0[c].innerText = "";
      col1[c].innerText = "";
      col2[c].innerText = "";
      col3[c].innerText = "";
      col4[c].innerText = "";
    }

    while (true) {
      if (jgb) {
        col0[i-1].innerText = String(i);
        col1[i-1].innerText = "";
        col2[i-1].innerText = "";
        col3[i-1].innerText = "100.00%";
        col4[i-1].innerText = "100.00%";
        break;
      }
      else {
        let p = p_init;
        if (i <= 10) {
          p += p_inc * (i-1);
        } else {
          p += p_inc * 10;
        }
        if (n_book >= i) p += p_book;

        let jg = p * 0.465;
        jg_sum += jg;
        if (jg_sum >= 1.0) {
           jg_sum = 1.0;
           jgb = true;
        }
        sum += (1 - sum) * p;
        try_sum += ((1 - sum) * p) * i;

        if (n_book >= i) {
          gold_sum += ((1 - sum) * p) * (nobook + price0) * i;
        } else {
          gold_sum += ((1 - sum) * p) * (nobook * i + price0 * n_book);
        }

        col0[i-1].innerText = String(i);
        col1[i-1].innerText = floatFix(p * 100) + "%";
        col2[i-1].innerText = floatFix(jg * 100) + "%";
        col3[i-1].innerText = floatFix(jg_sum * 100) + "%";
        col4[i-1].innerText = floatFix(sum * 100) + "%";
      }
      i += 1;
    }
    document.getElementById("num6").innerText = String(nobook + price0);
    document.getElementById("num7").innerText = String(nobook);
    document.getElementById("num8").innerText = floatFix(try_sum);
    document.getElementById("num9").innerText = floatFix(gold_sum);
  }

  changeState();
</script>